#!/bin/bash
# TODO:
# - back up /etc/zypp/repos.d
# - use screen

set -e
set -u
RELEASE=${1-12.3}

if test `id -u` -ne 0; then
    echo "Need to be root"
    exit 1
fi

zypper removeservice opensuse-12.2 || :
zypper removeservice opensuse || :
SVCDIR=$(cd $(dirname $0); pwd)
zypper addservice file://"$SVCDIR"/opensuse-$RELEASE opensuse
sed -i  "s/1[0-9]\\.[0-9]/$RELEASE/g" /etc/zypp/repos.d/*

zypper refresh-services
zypper install zypper
zypper dup
